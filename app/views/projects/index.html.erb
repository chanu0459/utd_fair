<%= select_tag 'sort_method', options_for_select(@order_hash, params[:sort_method] || @order_hash[0] ), {onchange: "paginateDataFetch(value,#{0}, #{@per_page})", class: 'form-control', style: 'float:right; width:20%; margin-right:2%'}  %>

<div id="projects_main">
	<ul class="col-md-12 tbl_row">
		<li class="col-md-3"> Title</li>
		<li class="col-md-2"> Date Added</li>
		<li class="col-md-2"> Category</li>
		<li class="col-md-3"> User</li>
		<li class="col-md-2"> Desc</li>
	</ul>
	<div id="content">

	<% @result.each do |proj| %>
		<ul class="col-md-12 tbl_row">
			<li class="col-md-3 "> <%= "#{proj.title.presence || '-'}" %> </li>
			<li class="col-md-2 "> <%= "#{proj.date_added.strftime('%b %e %Y')}" %> </li>
			<li class="col-md-2 "> <%= "#{proj.cname.presence || '-'}" %> </li>
			<li class="col-md-3 "> <%= "#{proj.uname}" %> </li>
			<li class="col-md-2 "> <%= "#{proj.description.presence || '-'}" %> </li>
		</ul>
	<% end %>

	</div>
	<div id="page_navigation"></div>
	<input type="hidden" name="current_page" id="current_page">
	<input type="hidden" name="show_per_page" id="show_per_page">
	<input type="hidden" name="total_pages" id="total_pages" value="<%= @total_pages%>">
</div>

<script type="text/javascript">
	$(document).ready(function(){
		customPagination(<%= @per_page %> , <%= @total_pages %>, <%= @page%>);
});

function customPagination(per_page, total_pages, page){

  // Items per Page
  var show_per_page =  per_page; 
  
  // Total Length
  //var number_of_items = $('#content').children().length;
  
  // No. of pages 
  //var number_of_pages = Math.ceil(number_of_items/show_per_page);
  var number_of_pages = total_pages

  //set the value of our hidden input fields
  $('#current_page').val(page);
  $('#show_per_page').val(show_per_page);

  var navigation_html = '<ul class="pagination">';

  navigation_html += '<li class="previous_link">';
  navigation_html += '<a href="javascript:previous();">&larr; Previous</a>';
  navigation_html += '</li>';
  var current_link = 0;
  while(number_of_pages > current_link){
    navigation_html += '<li class="page_link" id="id' + current_link +'">';
    navigation_html += '<a href="javascript:go_to_page(' + current_link +')" longdesc="' + current_link +'">'+ (current_link + 1) +'</a>';
    current_link++;
    navigation_html += '</li>';
  }
  navigation_html += '<li>';
  navigation_html += '<a class="next_link" href="javascript:next();">Next &rarr;</a>';
  navigation_html += '</li>';
  navigation_html += '</ul>';

  $('#page_navigation').html(navigation_html);

  //add active class to the first page link
  $('#page_navigation .page_link:nth-child('+ (page + 2) +')').addClass('active');

  //hide all the elements inside content div
  $('#content').children().css('display', 'none');

  //and show the first n (show_per_page) elements
  $('#content').children().slice(0, show_per_page).css('display', 'block');
}

function previous(){

  new_page = parseInt($('#current_page').val()) - 1;
  //if there is an item before the current active link run the function
  if($('.active').prev('.page_link').length==true){
    go_to_page(new_page);
  }

}

function next(){
  new_page = parseInt($('#current_page').val()) + 1;
  //if there is an item after the current active link run the function
  if($('.active').next('.page_link').length==true){
    go_to_page(new_page);
  }

}

function go_to_page(page_num){
  // Items per Page to show
  var show_per_page = parseInt($('#show_per_page').val());
  var sort_method = $("#sort_method").val()
  paginateDataFetch(sort_method, page_num, show_per_page)
  //Get first element index to show
 // start_from = page_num * show_per_page;

  //Get the last element index
  //end_on = start_from + show_per_page;

  //var get_box = document.getElementById("id"+page_num);
  //hide all children elements of content div, get specific items and show them
  //$('#content').children().css('display', 'none').slice(start_from, end_on).css('display', 'block');

  //$("#page_navigation").find('li.active').removeClass("active");
  //$(get_box).addClass("active");


  //update the current page input field
  //$('#current_page').val(page_num);
}

function paginateDataFetch(id,page,per_page) {
	console.log(id);
	 $.ajax({
	 	url: "/projects?sort_method="+id+"&per_page="+per_page+"&page="+page, 
	 	success: function(response){
	        //console.log(response)
	        var success =  $($.parseHTML(response)).filter("#projects_main").html(); 
			var total_pages = $($.parseHTML(response)).find("#total_pages").val()
	        $("#projects_main").html(success);
	        customPagination(per_page, total_pages, page);
	    },
		error: function (request, status, error) {
	        alert(request.responseText);
	    }
	});
}
</script>
